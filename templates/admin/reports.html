{% extends "base.html" %}

{% block title %}Reports - {{ app_name }}{% endblock %}

{% set active_page = 'reports' %}
{% block nav_items %}{% include 'components/nav_admin.html' %}{% endblock %}
{% block mobile_nav %}{% include 'components/nav_admin_mobile.html' %}{% endblock %}

{% block content %}
<h1 class="page-title">Performance Reports</h1>
<p class="page-subtitle">Overview of student performance</p>

<div class="card mb-2">
    <div class="card-header">Performance by Subject</div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
            {% for stat in subject_stats %}
            <div style="text-align: center; padding: 1rem; background: var(--gray-100); border-radius: var(--radius);">
                <div class="list-item-icon subject-{{ stat.code|lower }}" style="margin: 0 auto 0.5rem;">
                    {{ stat.subject_name[0] }}
                </div>
                <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">
                    {{ "%.0f"|format(stat.avg_score or 0) }}%
                </div>
                <div class="text-muted" style="font-size: 0.75rem;">{{ stat.total_exams }} exams</div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">Student Leaderboard</div>
    {% if student_stats %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Student</th>
                    <th>Exams</th>
                    <th>Avg Score</th>
                    <th>Best</th>
                </tr>
            </thead>
            <tbody>
                {% for student in student_stats %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ student.full_name }}</td>
                    <td>{{ student.total_exams }}</td>
                    <td>
                        {% if student.avg_score %}
                        <span style="font-weight: 600; {% if student.avg_score >= 80 %}color: var(--success);{% elif student.avg_score >= 60 %}color: var(--primary);{% else %}color: var(--warning);{% endif %}">
                            {{ "%.0f"|format(student.avg_score) }}%
                        </span>
                        {% else %}
                        -
                        {% endif %}
                    </td>
                    <td>{{ "%.0f"|format(student.best_score or 0) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p>No completed exams yet</p>
    </div>
    {% endif %}
</div>
{% endblock %}
